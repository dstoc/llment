# ollama-tui-test
Terminal chat interface to Ollama with MCP tool integration.

## Dependencies
- clap
  - parse command-line arguments
- async-openai
  - communicate with OpenAI-compatible models using streaming and tools
- tokio
  - asynchronous runtime
  - streaming via `tokio-stream`
- ratatui
  - terminal UI
    - input handling via `crossterm`
- rmcp
  - connect to MCP servers
- serde
  - load MCP server configuration
    - `serde_json` handles JSON parsing
- once_cell
  - shared state for loaded tools
- textwrap
  - wrap chat history
- termimad
  - render markdown
- insta
  - snapshot TUI rendering in tests

## Features, Requirements and Constraints
- assistant responses
  - stream incrementally
    - display "thinking" tokens before assistant messages
- MCP servers
  - loaded from configuration
    - expose tools
    - execute tool calls with error handling
- chat history
  - wrapped and scrollable
    - scrollbar and mouse support
  - padded to 100 columns and centered
    - user prompt boxes extend to the right edge
- reasoning and tool steps
  - grouped into a single "Thinking" block
    - shows "Thinking" while in progress
    - summarizes as "Thought for â€¦" when complete
    - persists across follow-up requests after tool calls
- OpenAI API base
  - specified via CLI option
- user prompts
  - render inside a boxed region
    - 5-character left margin followed by a blank line
  - thinking blocks
    - flush left with wrapped lines indented by two spaces
    - end with a blank line
- thinking steps
  - start with a bullet
  - tool names italicized
    - failed tool call headings render in red italics
    - tool arguments and results render as plain text
- markdown rendering
  - via termimad
    - preserves code block indentation and tables with padding and complete Unicode borders
    - code blocks and tables centered
      - code blocks show rectangular backgrounds
      - blank lines retain background shading
      - padding uses the base style
    - covered by tests rendered with Ratatui's `TestBackend`
      - insta inline snapshots include foreground/background colors
        - debug strings elide repeated style markers for readability
  - maps termimad foreground and background colors to ratatui styles
  - block quotes render with a styled quote mark and italic text
  - markdown skin
    - colors headings with ANSI 178
    - bold text yellow
    - italic text magenta
- UI rendering
  - drawing logic isolated for easier testing
  - chat layout verified with Ratatui's `TestBackend`
    - inline snapshots with `insta`
    - covers user, assistant, and thinking blocks
  - terminal cursor positioned at the bottom input prompt
- main loop
  - handles terminal events and async updates concurrently
  - UI remains interactive while requests stream or tools execute
  - after tool calls complete, sends a follow-up request with results for the final assistant response
    - inserts a new assistant placeholder before streaming the final response
